## 总体设计

### 1. 系统逻辑架构

系统采用“核心引擎+功能模块”的结构。块状链表作为底层通用的存储引擎，支撑了上层所有的业务数据管理。

- **底层：块状链表引擎 (`FileStore`)**
  - 通过 `MemoryRiver` 进行底层二进制读写。
  - 每个块（Node）存储多个键值对（Index-Value），块与块之间通过文件指针相连。
  - **优化机制**：实现了块的自动分裂（Split），确保在 $O(\sqrt{n})$ 的复杂度内完成增删改查，兼顾了顺序访问的性能和文件操作的灵活性。
- **中层：业务管理器 (`Manager`, `UserStore`, `Finance_Sys`)**
  - 将具体的业务对象（如 `Book`, `User`, `Finance`）映射为键值对存储在不同的索引库中。
- **顶层：命令解析与权限控制 (`main`, `UserStack`)**
  - 解析用户指令并维护登录栈，确保每个操作都经过块状链表引擎的持久化验证。

### 2. 详细设计：多维度索引方案

由于块状链表支持高效的范围查询和插入，系统为图书管理构建了多索引体系：

| **索引名称**       | **键 (Key)**    | **值 (Value)** | **作用**                         |
| ------------------ | --------------- | -------------- | -------------------------------- |
| **ISBN_Store**     | ISBN (String)   | Book_ID/Pos    | 通过ISBN唯一标识图书             |
| **BookName_Store** | 书名 (String)   | Book_ID/Pos    | 支持按书名检索（可能存在同名书） |
| **Author_Store**   | 作者 (String)   | Book_ID/Pos    | 支持按作者检索                   |
| **Keyword_Store**  | 关键字 (String) | Book_ID/Pos    | 支持按关键字检索（处理 `         |

**设计亮点**：

- **数据一致性**：当执行 `modify` 命令修改某本书的信息时，系统会同步更新上述所有的块状链表索引库，确保各维度查询结果的一致。
- **块内有序**：每个块状链表的块内数据保持有序，便于使用二分查找提高块内定位速度。

### 3. 存储与性能设计

- **二进制持久化**：所有的块数据直接映射到磁盘文件（如 `ISBN_Storage`, `UserList` 等）。利用块状链表，系统无需将整个数据库加载到内存，仅需加载相关的“块”即可处理请求，极大降低了内存占用。
- **缓存友好性**：块状链表的物理存储是连续的，利用了磁盘读取的局部性原理，减少了文件指针频繁 `seek` 的开销。
- **前缀和财务统计**：`Finance_Sys` 利用块状链表的顺序存储特性，通过存储累计收支流水，实现了快速的区间账目汇总。

### 4. 数据流设计

1. **查询流**：用户输入 `show -name="C++"` -> 解析模块提取键值 "C++" -> `BookName_Store` 引擎定位对应块 -> 遍历块并返回所有匹配项。
2. **更新流**：用户输入 `import` -> 逻辑层修改图书库存 -> 块状链表引擎找到对应 ISBN 的块 -> 原位更新数据或分裂块 -> 触发 `MemoryRiver` 写入磁盘。

### 5. 系统鲁棒性